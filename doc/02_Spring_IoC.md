---
typora-copy-images-to: pic
---

# Spring IoC

> 在本章节，重点讲解Spring IoC的设计思想与源码实现。

## 依赖倒置（Dependence Inversion）、控制反转（Inversion of Control）、依赖注入（Dependency Injection）

> 读者可能会被“依赖倒置”、“控制反转“、"依赖注入"这么多概念所混淆，其实讲的都是同类的事情。如果非要区分的话，依赖倒置（也成为控制反转）是原则（或者说是设计思想），依赖注入是实现方式，通过注入的方式实现了依赖倒置原则。

​	**解耦和最重要的原则就是依赖倒置原则：高层模块不应该依赖底层模块，他们都应该依赖抽象。抽象不应该依赖于细节，细节应该依赖于抽象。** 试想如果合作对象的引用或依赖关系的管理有具体的对象来完成，会导致代码的高度耦合和测试性降低，这对复杂的面向对象系统的设计是非常不利的，而把控制权从具体业务对象手中转交到平台或者框架中，是降低面向对象系统设计复杂性和提高面向对象系统可测试性的一个有效解决方案。

​	如下图左所示，在没有引入IoC容器之前，各个对象是直接耦合在一起的，这样高度耦合的关系对测试和重构都不友好；在引入IoC容器之后，如下图中所示，使用容器来管理各个对象之间的依赖，大大降低了对象之间的耦合性；同时发现去掉这些IoC容器，如下图右所示，这些对象仍然可以独立的进行开发；可见引入IoC容器之后不仅方便了对象之间的关联管理，也使得对象都可以独立的进行开发和测试。

![](pic/ioc2.png)

​	在Spring中，通过使用IoC容器，对象依赖关系的管理被反转了，转到IoC容器中来了，对象之间的相互依赖关系有IoC容器进行管理，并由IoC容器完成对象的注入。在具体的注入实现中，接口注入、setter注入和构造器注入都是主要的注入方式。在Spring的IoC设计中，setter注入和构造器注入是主要的注入方式。

注：更多关于依赖倒置原理，请参考：[Spring的IOC原理](http://www.importnew.com/14751.html)

> 在了解控制反转之后，下面我们将重点讲解Spring是如何实现控制反转容器的。

## Spring IoC容器的设计

​	Spring 提供了两个主要的容器系列，一个是实现了**BeanFactory**接口的简单容器系列，这个系列的容器实现了容器最为基本的功能，另一个是**ApplicationContext**，最为高级容器，他在BeanFactory基础上增加了许多面向框架的特性，同时对应用环境做了许多适配。下面我们就开始分析Spring IoC容器。

如下所示，是Spring IoC容器完整的类继承关系图，

![](pic/BeanFactory.png)

上述树状图无法直观展示类继承关系，我们用如下的简略图来表示：

![](pic/BeanFactory1.png)

​	接口-抽象类-具体类是Java编程的三剑客。我们用接口来定义规范，表述当前这个接口能够提供哪些服务；抽象类是实现了一个或多个接口的部分服务的模板类，有了这些模板类可以把一些公共的方法提取出来并实现，方便用户直接基于模板类进行具体类的设计与实现；而具体类就是针对某种场景的具体实现方式，一般同一个服务针对不同的场景可能有不同的实现方式，这些不同实现方式是通过具体类来具体实施的。同理，Spring IoC容器也遵循这个规范，我们设计了一个基类接口BeanFactory，它定义了一个IoC容器所需的最基本的功能；然后又在该基本功能的基础上继续添加新的功能，以适应不同的场景。